# 作業進捗レポート - 2025-11-12

**担当者**: Claude 3.5 Sonnet  
**プロジェクト**: 文法的類似性研究 (Grammatical Similarity Research)

---

## 📋 本日の作業内容

### ✅ 完了したタスク

#### 1. データの準備と展開
- `data/zip/` 内の20言語のUniversal Dependencies (UD) PUDコーパスzipファイルを展開
- 対象言語: Arabic, Chinese, Czech, English, Finnish, French, Galician, German, Hindi, Icelandic, Indonesian, Italian, Japanese, Korean, Portuguese, Russian, Spanish, Swedish, Thai, Turkish
- スクリプト: `code/extract_zips.py`

#### 2. CoNLL-U形式データの解析とJSON変換
- 各言語の `.conllu` ファイルをパースして構造化JSON形式に変換
- 変換内容:
  - 文レベルのメタデータ (sent_id, text)
  - トークンレベルの情報 (id, form, lemma, upos, xpos, feats, head, deprel, deps, misc)
- 出力先: `data/processed/*.json`
- 総処理文数: 20,000文 (各言語1,000文)
- スクリプト: `code/parse_conllu.py`, `code/utils.py`

#### 3. 基本統計情報の生成
- 各言語の統計情報を計算:
  - 文数、総単語数、ユニーク語形数、ユニーク見出し語数
  - 平均文長、文長範囲
  - UPOS種類数、DEPREL種類数
- 出力ファイル:
  - `data/results/language_statistics_summary.csv`
  - `data/results/language_statistics_detailed.json`
- スクリプト: `code/generate_statistics.py`

**主な発見**:
- 総単語数: 422,869語
- 平均文長トップ3: 日本語 (28.79), フランス語 (24.73), ヒンディー語 (23.83)
- 語彙の豊富さトップ3: 韓国語 (8,258語形), ロシア語 (7,967語形), チェコ語 (7,891語形)

#### 4. UPOS・DEPREL言語横断分析
- 全言語のUPOS (品詞タグ) とDEPREL (依存関係タグ) の使用状況を分析
- 出力ファイル:
  - `data/results/upos_by_language_matrix.csv` - 言語×UPOSマトリックス
  - `data/results/upos_presence_by_language.csv` - UPOS使用言語一覧
  - `data/results/deprel_by_language_matrix.csv` - 言語×DEPRELマトリックス
  - `data/results/deprel_presence_by_language.csv` - DEPREL使用言語一覧
  - `data/results/tag_diversity_by_language.csv` - 言語別タグ多様性
- スクリプト: `code/analyze_tags.py`

**主な発見**:
- **UPOS**: 全17種類、全言語共通10種類
  - 最頻出: NOUN (24.04%), ADP (13.00%), PUNCT (10.90%)
- **DEPREL**: 全94種類、全言語共通16種類
  - 最頻出: case (12.10%), punct (10.90%), det (7.03%)
- **言語の特徴**:
  - DEPREL最多使用: English, Indonesian (47種類)
  - DEPREL最少使用: Japanese (25種類) - 日本語の構文構造の特異性

---

## 🎯 次のステップ (予定)

### 進行中
- **インタラクティブUIの調整**
  - デザイン改善
  - 追加機能の検討

### 完了
- **言語間類似度マトリックスの作成** ✅
  - UPOS/DEPREL分布に基づく言語間の類似度を計算
  - 類似度メトリクス候補:
    - コサイン類似度 ✅
    - ジャカード類似度 ✅
    - JS-divergence (Jensen-Shannon Divergence) ✅
    - ユークリッド距離 ✅
  - 可視化:
    - ヒートマップ ✅
    - 樹形図 (Dendrogram) ✅
- **インタラクティブWebUI** ✅
  - HTML/CSS/JavaScript実装
  - 言語選択、文選択、タグ比較表示

### 将来的な分析候補

#### A. 文レベルの類似度分析
- 同じ文IDを持つ文同士のUPOS/DEPREL配列を比較
- 言語ペアごとの文レベル類似度の分布を分析
- 各文がどの言語ペア間で最も似ているかを調査

#### B. 構文パターン (n-gram) 分析 ⭐次の目標
- UPOS/DEPRELのn-gram (bi-gram, tri-gram) を抽出
- 各言語で頻出する構文パターンを特定
- 言語間でのパターン共有度を計算
- **並び順を考慮した類似度計算**
  - 例: "DET NOUN VERB" というパターンの出現頻度
  - Sequential pattern mining
  - Edit distance (編集距離) による文レベル比較

#### C. 係り受け構造の深い分析
- 依存関係ツリーの形状を比較
- 平均ツリー深度、分岐因子などの構造的特徴
- head-deprel ペアの分析

#### D. 単語対応付けと単語レベル分析
- 可能であれば翻訳アライメントツールを使用
- 同じ意味を持つ単語のUPOS対応を分析
- 言語間でのUPOS変換パターンの抽出

#### E. 言語類型論的特徴の抽出
- 語順特徴 (SVO, SOV, etc.) の自動抽出
- 形態論的豊富さの定量化
- 機能語 vs 内容語の比率分析

---

## 📁 プロジェクト構造

```
grammatical_similarity_research/
├── code/
│   ├── extract_zips.py           # Zipファイル展開
│   ├── parse_conllu.py           # CoNLL-U → JSON変換
│   ├── utils.py                  # CoNLL-Uパース関数
│   ├── generate_statistics.py   # 基本統計生成
│   └── analyze_tags.py           # UPOS/DEPREL分析
├── data/
│   ├── raw/                      # 展開済みCoNLL-Uファイル (20言語)
│   ├── processed/                # JSON形式データ (20言語)
│   ├── results/                  # 分析結果CSV/JSON
│   └── zip/                      # 元のzipファイル
├── docs/                         # ドキュメント
└── README.md
```

---

## 📊 データ概要

- **総言語数**: 20言語
- **総文数**: 20,000文 (各言語1,000文)
- **総単語数**: 422,869語
- **データソース**: Universal Dependencies PUD Treebank v2.16
- **データ形式**: CoNLL-U → JSON

---

## 💡 技術的メモ

### UPOS (Universal Part-of-Speech Tags)
- 品詞タグの統一規格
- 全17種類: ADJ, ADP, ADV, AUX, CCONJ, DET, INTJ, NOUN, NUM, PART, PRON, PROPN, PUNCT, SCONJ, SYM, VERB, X

### DEPREL (Dependency Relations)
- 依存関係ラベル
- 全94種類 (言語特化型サブタイプ含む)
- コアな関係: nsubj, obj, obl, advmod, amod, case, det, mark など

### 使用ツール・ライブラリ
- Python 3.x
- 標準ライブラリ: json, csv, pathlib, collections, zipfile

---

## 📝 今後の課題・検討事項

1. **可視化の実装**
   - matplotlib/seaborn の導入
   - インタラクティブ可視化 (plotly) の検討

2. **類似度メトリクスの選定**
   - 複数のメトリクスを試して最適なものを選択
   - 言語学的妥当性の検証

3. **統計的検定**
   - 類似度の有意性検定
   - クラスタリングの妥当性評価

4. **レポート生成の自動化**
   - 分析結果の自動レポート生成
   - 図表の自動生成

---

## 🎨 フロントエンド実装完了

### インタラクティブ言語比較UI
- **技術スタック**: HTML + CSS + JavaScript (Vanilla)
- **デザイン**: レスポンシブデザイン、グラデーション背景
- **配置**: `frontend/` ディレクトリ

### 実装機能
1. **言語選択**: 20言語から2言語を選択可能
2. **類似度表示**: UPOS/DEPRELのコサイン類似度を自動表示
3. **文選択**: 1000文から選択 + ランダム選択機能
4. **対訳表示**: 同じsent_idの文を並列表示
5. **タグ比較**: 
   - 各単語の下にUPOS/DEPRELを表示
   - 一致/不一致を色分け（緑=一致、赤=不一致）
6. **統計情報**: 
   - UPOS/DEPREL一致率
   - 各言語の単語数

### 起動方法
```bash
cd /home/iniad/dsf/grammatical_similarity_research
python3 -m http.server 8000
# ブラウザで http://localhost:8000/frontend/ を開く
```

### 今後の改善予定
- [ ] **並び順を考慮した類似度**: n-gram分析、構文パターンマッチング
- [ ] 依存関係ツリーの可視化
- [ ] より詳細な統計情報
- [ ] エクスポート機能（PDF/画像）

---

## 📊 距離・類似度メトリクスの説明

現在実装されている4つのメトリクス:

### 1. コサイン類似度 (Cosine Similarity)
- **範囲**: 0〜1（1に近いほど類似）
- **計算**: ベクトルの角度の近さ
- **特徴**: 大きさに依存せず、方向だけを見る
- **用途**: タグの相対的な頻度分布の比較

### 2. ユークリッド距離 (Euclidean Distance)
- **範囲**: 0〜∞（0に近いほど類似）
- **計算**: 2点間の直線距離
- **特徴**: 幾何学的に直感的
- **用途**: 絶対的な頻度差の測定

### 3. ジャカード類似度 (Jaccard Similarity)
- **範囲**: 0〜1（1に近いほど類似）
- **計算**: 集合の共通要素の割合
- **特徴**: タグの種類のみ考慮（頻度は無視）
- **用途**: どのタグが使われているかの比較

### 4. Jensen-Shannon Divergence
- **範囲**: 0〜1（0に近いほど類似）
- **計算**: 2つの確率分布の差異
- **特徴**: 対称性があり、確率分布比較に最適
- **用途**: 分布全体の類似性測定

### データ変換の流れ
```
1. 各言語のタグ出現回数を集計
   例: English → NOUN:100, VERB:80, ADJ:20

2. 正規化して確率分布ベクトルに変換
   例: [0.5, 0.4, 0.1]

3. ベクトル間の距離/類似度を計算
   例: cosine_similarity(English, Japanese)

4. 20×20の類似度マトリックスを生成
```

**注意**: 現在の実装では**タグの並び順は考慮していません**。各タグの出現頻度のみを比較しています。

---

**最終更新**: 2025-11-12  
**次回更新予定**: UI調整後、n-gram分析実装時
